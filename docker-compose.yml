version: '3.4'

services:

  apps.mongodb:
    image: appsmongodb
    build:
      context: .
      dockerfile: apps-foundation/Apps_MongoDB/Dockerfile
    ports:
      - "27017:27017"
    environment:
      ME_CONFIG_MONGODB_ADMINUSERNAME: root
      ME_CONFIG_MONGODB_ADMINPASSWORD: root
    networks: 
      - dmz-morejee-net

  apps.postgresdb:
    image: appspostgresdb
    build:
      context: .
      dockerfile: apps-foundation/Apps_PostgresDB/Dockerfile
    ports:
      - "15266:5432"
    volumes:
      - "/var/bamboo/postgresdb/data:/var/lib/postgresql/data"
    environment:
      POSTGRES_USER: 'postgres'
      POSTGRES_PASSWORD: 'root'
    networks: 
      - dmz-morejee-net

  # apps.base.apigateway:
  #   image: appsbaseapigateway
  #   build:
  #     context: .
  #     dockerfile: apps-common/Apps.Base.APIGateway/Dockerfile
  #   ports:
  #     - "1881:80"
  #   volumes:
  #     - "/var/bamboo/appsbaseapigateway/logs:/app/logs"
  #   networks:
  #     - dmz-morejee-net
  #   depends_on:
  #     - apps.basic.service
  #     - apps.mongodb

  apps.basic.service:
    image: appsbasicservice
    build:
      context: .
      dockerfile: apps-basic/Apps.Basic.Service/Dockerfile
    ports:
      - "1882:80"
    volumes:
      - "/var/bamboo/appsbasicservice/logs:/app/logs"
    environment:
      ConnectionString: 'Server=apps.postgresdb;Port=5432;Database=dmz_basic;User Id=postgres;Password=root'
    networks:
      - dmz-morejee-net

  # apps.morejee.service:
  #   image: appsmorejeeservice
  #   build:
  #     context: .
  #     dockerfile: apps-morejee/Apps.MoreJee.Service/Dockerfile
  #   ports:
  #     - "1883:80"
  #   volumes:
  #     - "/var/bamboo/appsmorejeeservice/logs:/app/logs"
  #   environment:
  #     ConnectionString: 'Server=192.168.1.6;Port=5433;Database=dmz_morejee;User Id=postgres;Password=omega'
  #   networks:
  #     - dmz-morejee-net


networks:
  dmz-morejee-net: